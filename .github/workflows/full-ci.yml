name: Full CI Check

on:
  pull_request:
    types: [opened, synchronize, reopened]
  push:
    branches: [ main, master, develop ]

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  game-logic-tests:
    name: Game Logic Tests
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: |
        pip install pytest
        
    - name: Run critical game logic tests
      run: |
        echo "=== 运行关键游戏逻辑测试 ==="
        
        # 测试交易系统
        python -m pytest test_forest.py::TestForestGame::test_trade_success -v
        python -m pytest test_forest.py::TestForestGame::test_trade_fail_exceeds_limit -v
        
        # 测试捕食系统
        python -m pytest test_forest.py::TestForestGame::test_hunt_success -v
        python -m pytest test_forest.py::TestForestGame::test_hunt_fail_reverse -v
        
        # 测试规则系统
        python -m pytest test_forest.py::TestForestGame::test_check_restraint_12_players -v
        python -m pytest test_rules.py::TestRestraintRules::test_rank_restraint_chain -v

        python -m pytest test_forest.py::TestForestGame::test_assign_identities_12_players -v
        python -m pytest test_forest.py::TestForestGame::test_trade_fail_insufficient_blood -v
        python -m pytest test_forest.py::TestForestGame::test_suit_restraint_12_players -v
        python -m pytest test_forest.py::TestForestGame::test_tie_conditions_12_players -v
        python -m pytest test_forest.py::TestForestGame::test_heart_k_vs_spade_q_should_fail -v
        python -m pytest test_forest.py::TestForestGame::test_hunt_success -v
        python -m pytest test_forest.py::TestForestGame::test_hunt_fail_reverse -v
        python -m pytest test_forest.py::TestForestGame::test_hunt_player_death -v
        python -m pytest test_forest.py::TestForestGame::test_modify_blood -v
        python -m pytest test_forest.py::TestForestGame::test_modify_blood_to_death -v
        python -m pytest test_forest.py::TestForestGame::test_joker_special_rules -v
        python -m pytest test_forest.py::TestForestGame::test_different_player_counts -v
        python -m pytest test_forest.py::TestComprehensiveScenarios::test_full_game_flow -v
